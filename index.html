<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Almond Properties - Your Kitsap Realtor. Over 30 years helping home buyers in Kitsap County, Washington.">
    <title>Almond Properties | Your Kitsap Realtor</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/gallery.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Open+Sans:wght@400;500;600&display=swap" rel="stylesheet">
    <!-- Netlify Identity Widget - handles invite/confirmation tokens -->
    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
</head>
<body>
    <header class="header">
        <nav class="nav container">
            <a href="index.html" class="logo">
                <span class="logo-icon">üè†</span>
                <span class="logo-text">Almond Properties</span>
            </a>
            <button class="nav-toggle" aria-label="Toggle navigation">
                <span></span>
                <span></span>
                <span></span>
            </button>
            <ul class="nav-menu">
                <li><a href="index.html" class="active">Home</a></li>
                <li><a href="listings.html">Listings</a></li>
                <li><a href="about.html">About</a></li>
                <li><a href="contact.html">Contact</a></li>
            </ul>
        </nav>
    </header>

    <main>
        <section class="hero">
            <div class="hero-content container">
                <h1>Find Your Perfect Home</h1>
                <p>Your Kitsap Realtor - Over 30 years helping home buyers in Kitsap County</p>
                <a href="listings.html" class="btn btn-primary">View Listings</a>
                <a href="contact.html" class="btn btn-secondary">Contact Us</a>
            </div>
        </section>

        <section class="featured-listings section">
            <div class="container">
                <h2 class="section-title">Featured Properties</h2>
                <div id="featured-carousel-container">
                    <!-- Carousel loaded via JavaScript -->
                </div>
                <div class="text-center mt-2">
                    <a href="listings.html" class="btn btn-outline">View All Listings</a>
                </div>
            </div>
        </section>

        <section class="services section bg-light">
            <div class="container">
                <h2 class="section-title">Our Services</h2>
                <div class="services-grid">
                    <div class="service-card">
                        <div class="service-icon">üè°</div>
                        <h3>Buying</h3>
                        <p>We help you find the perfect home that fits your needs and budget.</p>
                    </div>
                    <div class="service-card">
                        <div class="service-icon">üí∞</div>
                        <h3>Selling</h3>
                        <p>Get top dollar for your property with our proven marketing strategies.</p>
                    </div>
                    <div class="service-card">
                        <div class="service-icon">üìã</div>
                        <h3>Property Management</h3>
                        <p>Professional management services for your investment properties.</p>
                    </div>
                </div>
            </div>
        </section>

        <section class="cta section">
            <div class="container text-center">
                <h2>Ready to Make a Move?</h2>
                <p>Contact us today for a free consultation</p>
                <a href="contact.html" class="btn btn-primary">Get in Touch</a>
            </div>
        </section>
    </main>

    <footer class="footer">
        <div class="container">
            <div class="footer-grid">
                <div class="footer-about">
                    <h3>Almond Properties</h3>
                    <p>Your Kitsap Realtor - Over 30 years of experience helping home buyers.</p>
                </div>
                <div class="footer-links">
                    <h4>Quick Links</h4>
                    <ul>
                        <li><a href="listings.html">Listings</a></li>
                        <li><a href="about.html">About Us</a></li>
                        <li><a href="contact.html">Contact</a></li>
                    </ul>
                </div>
                <div class="footer-contact">
                    <h4>Contact Us</h4>
                    <p>18120 Viking Way NW<br>Poulsbo, WA 98370<br>
                    <a href="mailto:info@almondproperties.com">info@almondproperties.com</a></p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; <span id="year"></span> Almond Properties. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script src="js/listings.js"></script>
    <script src="js/carousel.js"></script>
    <script src="js/main.js"></script>
    <script>
        // Initialize featured carousel on homepage
        document.addEventListener('DOMContentLoaded', async function() {
            const container = document.getElementById('featured-carousel-container');
            if (container) {
                const listings = await loadListings();
                container.innerHTML = createFeaturedCarousel(listings);
                initFeaturedCarousel();
            }
        });

        // Handle Netlify Identity redirects (invite/confirmation tokens)
        if (window.netlifyIdentity) {
            window.netlifyIdentity.on('init', user => {
                if (!user) {
                    window.netlifyIdentity.on('login', () => {
                        document.location.href = '/admin/';
                    });
                }
            });

            window.netlifyIdentity.on('signup', () => {
                document.location.href = '/admin/';
            });

            // Initialize and handle tokens
            window.netlifyIdentity.init({
                APIUrl: 'https://almondproperties.netlify.app/.netlify/identity'
            });

            // Check for any Identity tokens in URL hash and open widget
            const hash = window.location.hash;
            if (hash && (
                hash.includes('invite_token') ||
                hash.includes('confirmation_token') ||
                hash.includes('recovery_token') ||
                hash.includes('access_token')
            )) {
                console.log('Identity token detected:', hash.substring(0, 50) + '...');
                window.netlifyIdentity.open();
            }
        }
    </script>
</body>
</html>
