<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Property details - Almond Properties">
    <title>Property Details | Almond Properties</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/gallery.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Open+Sans:wght@400;500;600&display=swap" rel="stylesheet">
</head>
<body>
    <header class="header">
        <nav class="nav container">
            <a href="index.html" class="logo">
                <span class="logo-icon">üè†</span>
                <span class="logo-text">Almond Properties</span>
            </a>
            <button class="nav-toggle" aria-label="Toggle navigation">
                <span></span>
                <span></span>
                <span></span>
            </button>
            <ul class="nav-menu">
                <li><a href="index.html">Home</a></li>
                <li><a href="listings.html">Listings</a></li>
                <li><a href="about.html">About</a></li>
                <li><a href="contact.html">Contact</a></li>
            </ul>
        </nav>
    </header>

    <main class="property-detail">
        <div id="property-content">
            <div class="loading" style="padding: 8rem 2rem;">Loading property details...</div>
        </div>
    </main>

    <footer class="footer">
        <div class="container">
            <div class="footer-grid">
                <div class="footer-about">
                    <h3>Almond Properties</h3>
                    <p>Your Kitsap Realtor - Over 30 years of experience helping home buyers.</p>
                </div>
                <div class="footer-links">
                    <h4>Quick Links</h4>
                    <ul>
                        <li><a href="listings.html">Listings</a></li>
                        <li><a href="about.html">About Us</a></li>
                        <li><a href="contact.html">Contact</a></li>
                    </ul>
                </div>
                <div class="footer-contact">
                    <h4>Contact Us</h4>
                    <p>18120 Viking Way NW<br>Poulsbo, WA 98370<br>
                    <a href="mailto:info@almondproperties.com">info@almondproperties.com</a></p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; <span id="year"></span> Almond Properties. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script src="js/main.js"></script>
    <script src="js/carousel.js"></script>
    <script>
        // Format price as currency
        function formatPrice(price) {
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD',
                maximumFractionDigits: 0
            }).format(price);
        }

        // Format number with commas
        function formatNumber(num) {
            return new Intl.NumberFormat('en-US').format(num);
        }

        // Get status label
        function getStatusLabel(status) {
            const labels = {
                'active': 'For Sale',
                'pending': 'Pending',
                'sold': 'Sold'
            };
            return labels[status] || status;
        }

        // Create Google Maps embed URL
        function getMapEmbedUrl(address, city, state, zip) {
            const fullAddress = encodeURIComponent(`${address}, ${city}, ${state} ${zip}`);
            return `https://www.google.com/maps?q=${fullAddress}&output=embed`;
        }

        // Create Walkscore URL
        function getWalkscoreUrl(address, city, state, zip) {
            const fullAddress = encodeURIComponent(`${address} ${city} ${state} ${zip}`);
            return `https://www.walkscore.com/score/${fullAddress}`;
        }

        // Load property details
        async function loadProperty() {
            const params = new URLSearchParams(window.location.search);
            const propertyId = params.get('id');

            if (!propertyId) {
                showError('No property ID specified');
                return;
            }

            try {
                const response = await fetch('data/listings.json');
                const data = await response.json();
                const property = data.listings.find(l => l.id === propertyId);

                if (!property) {
                    showError('Property not found');
                    return;
                }

                renderProperty(property);
                document.title = `${property.title} | Almond Properties`;

            } catch (error) {
                console.error('Error loading property:', error);
                showError('Failed to load property details');
            }
        }

        function showError(message) {
            document.getElementById('property-content').innerHTML = `
                <div class="container" style="padding: 8rem 2rem; text-align: center;">
                    <h2>${message}</h2>
                    <p class="mt-2"><a href="listings.html" class="btn btn-primary">View All Listings</a></p>
                </div>
            `;
        }

        function renderProperty(property) {
            const statusClass = property.status === 'sold' ? 'sold' : property.status === 'pending' ? 'pending' : '';

            const featuresHtml = property.features
                ? property.features.map(f => `<li>‚úì ${f}</li>`).join('')
                : '';

            const mlsHtml = property.mlsNumber
                ? `<div class="mls-info" style="margin-bottom: 1.5rem; padding: 1rem; background: var(--bg-light); border-radius: var(--radius); display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 0.5rem;">
                    <span style="font-weight: 600;">MLS# ${property.mlsNumber}</span>
                    <a href="https://www.nwmls.com/listings/${property.mlsNumber}" target="_blank" rel="noopener" class="btn btn-outline" style="padding: 0.5rem 1rem; font-size: 0.875rem;">View on NWMLS</a>
                   </div>`
                : '';

            // Create gallery HTML
            const galleryHtml = createPropertyGallery(property.images);

            // Create map and walkscore URLs
            const mapUrl = getMapEmbedUrl(property.address, property.city, property.state, property.zip);
            const walkscoreUrl = getWalkscoreUrl(property.address, property.city, property.state, property.zip);
            const fullAddress = `${property.address}, ${property.city}, ${property.state} ${property.zip}`;

            document.getElementById('property-content').innerHTML = `
                ${galleryHtml}

                <section class="property-info section">
                    <div class="container">
                        <div class="property-info-grid">
                            <div class="property-main">
                                <span class="property-status ${statusClass}" style="display: inline-block; margin-bottom: 1rem;">${getStatusLabel(property.status)}</span>
                                <h1>${property.title}</h1>
                                <p class="property-address">${fullAddress}</p>
                                <div class="property-price" style="font-size: 2rem; margin-bottom: 1rem;">${formatPrice(property.price)}</div>
                                ${mlsHtml}

                                <div class="property-specs">
                                    <div class="spec-item">
                                        <span class="spec-label">Bedrooms</span>
                                        <span class="spec-value">${property.bedrooms}</span>
                                    </div>
                                    <div class="spec-item">
                                        <span class="spec-label">Bathrooms</span>
                                        <span class="spec-value">${property.bathrooms}</span>
                                    </div>
                                    <div class="spec-item">
                                        <span class="spec-label">Square Feet</span>
                                        <span class="spec-value">${formatNumber(property.sqft)}</span>
                                    </div>
                                    <div class="spec-item">
                                        <span class="spec-label">Lot Size</span>
                                        <span class="spec-value">${property.lotSize || 'N/A'}</span>
                                    </div>
                                    <div class="spec-item">
                                        <span class="spec-label">Year Built</span>
                                        <span class="spec-value">${property.yearBuilt || 'N/A'}</span>
                                    </div>
                                    <div class="spec-item">
                                        <span class="spec-label">Property Type</span>
                                        <span class="spec-value">${property.type.charAt(0).toUpperCase() + property.type.slice(1)}</span>
                                    </div>
                                </div>

                                <div class="property-description mt-2">
                                    <h3>Description</h3>
                                    <p>${property.description}</p>
                                </div>

                                ${featuresHtml ? `
                                <div class="property-features-list mt-2">
                                    <h3>Features</h3>
                                    <ul style="columns: 2; list-style: none; padding: 0;">
                                        ${featuresHtml}
                                    </ul>
                                </div>
                                ` : ''}

                                <!-- Location Section -->
                                <div class="location-section">
                                    <h3>Location & Neighborhood</h3>
                                    <div class="location-grid">
                                        <div class="map-container">
                                            <iframe
                                                src="${mapUrl}"
                                                allowfullscreen=""
                                                loading="lazy"
                                                referrerpolicy="no-referrer-when-downgrade"
                                                title="Property location map">
                                            </iframe>
                                        </div>
                                        <div class="walkscore-container">
                                            <h4>Walk Score</h4>
                                            <p style="color: var(--text-light); font-size: 0.9rem; margin-bottom: 1rem;">
                                                Check the walkability, transit options, and bike-friendliness of this location.
                                            </p>
                                            <a href="${walkscoreUrl}" target="_blank" rel="noopener" class="btn btn-primary">
                                                View Walk Score
                                            </a>
                                            <p style="margin-top: 1rem; font-size: 0.8rem; color: var(--text-light);">
                                                Walk Score measures walkability on a scale of 0-100 based on walking routes to nearby amenities.
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="contact-sidebar">
                                <h3>Interested in this property?</h3>
                                <p style="margin-bottom: 1.5rem; color: var(--text-light);">Contact us to schedule a viewing or get more information.</p>

                                <form id="inquiry-form" name="property-inquiry" method="POST" data-netlify="true" netlify-honeypot="bot-field">
                                    <input type="hidden" name="form-name" value="property-inquiry">
                                    <input type="hidden" name="property" value="${property.title} - ${property.address}">

                                    <p class="ohnohoney">
                                        <label>Don't fill this out: <input name="bot-field"></label>
                                    </p>

                                    <div class="form-group">
                                        <label for="inquiry-name">Your Name *</label>
                                        <input type="text" id="inquiry-name" name="name" required>
                                    </div>

                                    <div class="form-group">
                                        <label for="inquiry-email">Email *</label>
                                        <input type="email" id="inquiry-email" name="email" required>
                                    </div>

                                    <div class="form-group">
                                        <label for="inquiry-phone">Phone</label>
                                        <input type="tel" id="inquiry-phone" name="phone">
                                    </div>

                                    <div class="form-group">
                                        <label for="inquiry-message">Message</label>
                                        <textarea id="inquiry-message" name="message" rows="4">I'm interested in this property and would like more information.</textarea>
                                    </div>

                                    <button type="submit" class="btn btn-primary" style="width: 100%;">Send Inquiry</button>
                                </form>

                                <div style="margin-top: 1.5rem; padding-top: 1.5rem; border-top: 1px solid var(--border-color);">
                                    <p style="margin-bottom: 0.5rem;"><strong>Or contact us directly:</strong></p>
                                    <p><a href="mailto:info@almondproperties.com">info@almondproperties.com</a></p>
                                </div>
                            </div>
                        </div>

                        <div class="mt-2">
                            <a href="listings.html" class="btn btn-outline">‚Üê Back to Listings</a>
                        </div>
                    </div>
                </section>
            `;

            // Initialize gallery if multiple images
            if (property.images && property.images.length > 0) {
                initPropertyGallery(property.images);
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', loadProperty);
    </script>
</body>
</html>
